apiVersion: batch/v1
kind: CronJob
metadata:
  name: {{ template "batch-server.fullname" . }}-experiment-status-updater
  namespace: {{ .Values.namespace }}
  labels:
    app: {{ template "batch-server.name" . }}
    chart: {{ template "batch-server.chart" . }}
    release: {{ template "batch-server.fullname" . }}
    heritage: {{ .Release.Service }}
spec:
  schedule: {{ .Values.cronjob.experimentStatusUpdaterSchedule }}
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: experiment-status-updater
              image: curlimages/curl:8.1.2
              imagePullPolicy: IfNotPresent
              command:
                - "curl"
              args:
                - "-X"
                - "POST"
                - "-d"
                - '{"job": "ExperimentStatusUpdater"}'
                - "-H"
                - "authorization: bearer {{ template "service-token-secret" . }}"
                - "https://web-gateway.{{ .Values.namespace }}.svc.cluster.local:{{ .Values.cronjob.webGatewayPort }}/bucketeer.batch.BatchService/ExecuteBatchJob"
          restartPolicy: Never

---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: {{ template "batch-server.fullname" . }}-experiment-running-watcher
  namespace: {{ .Values.namespace }}
  labels:
    app: {{ template "batch-server.name" . }}
    chart: {{ template "batch-server.chart" . }}
    release: {{ template "batch-server.fullname" . }}
    heritage: {{ .Release.Service }}
spec:
  schedule: {{ .Values.cronjob.experimentRunningWatcherSchedule }}
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: experiment-running-watcher
              image: curlimages/curl:8.1.2
              imagePullPolicy: IfNotPresent
              command:
                - "curl"
              args:
                - "-X"
                - "POST"
                - "-d"
                - '{"job": "ExperimentRunningWatcher"}'
                - "-H"
                - "authorization: bearer {{ template "service-token-secret" . }}"
                - "https://web-gateway.{{ .Values.namespace }}.svc.cluster.local:{{ .Values.cronjob.webGatewayPort }}/bucketeer.batch.BatchService/ExecuteBatchJob"
          restartPolicy: Never

---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: {{ template "batch-server.fullname" . }}-feature-state-watcher
  namespace: {{ .Values.namespace }}
  labels:
    app: {{ template "batch-server.name" . }}
    chart: {{ template "batch-server.chart" . }}
    release: {{ template "batch-server.fullname" . }}
    heritage: {{ .Release.Service }}
spec:
  schedule: {{ .Values.cronjob.featureStateWatcherSchedule }}
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: feature-state-watcher
              image: curlimages/curl:8.1.2
              imagePullPolicy: IfNotPresent
              command:
                - "curl"
              args:
                - "-X"
                - "POST"
                - "-d"
                - '{"job": "FeatureStateWatcher"}'
                - "-H"
                - "authorization: bearer {{ template "service-token-secret" . }}"
                - "https://web-gateway.{{ .Values.namespace }}.svc.cluster.local:{{ .Values.cronjob.webGatewayPort }}/bucketeer.batch.BatchService/ExecuteBatchJob"
          restartPolicy: Never

---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: {{ template "batch-server.fullname" . }}-mau-count-watcher
  namespace: {{ .Values.namespace }}
  labels:
    app: {{ template "batch-server.name" . }}
    chart: {{ template "batch-server.chart" . }}
    release: {{ template "batch-server.fullname" . }}
    heritage: {{ .Release.Service }}
spec:
  timeZone: {{ .Values.env.timezone }}
  schedule: {{ .Values.cronjob.mauCountWatcherSchedule }}
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: mau-count-watcher
              image: curlimages/curl:8.1.2
              imagePullPolicy: IfNotPresent
              command:
                - "curl"
              args:
                - "-X"
                - "POST"
                - "-d"
                - '{"job": "MauCountWatcher"}'
                - "-H"
                - "authorization: bearer {{ template "service-token-secret" . }}"
                - "https://web-gateway.{{ .Values.namespace }}.svc.cluster.local:{{ .Values.cronjob.webGatewayPort }}/bucketeer.batch.BatchService/ExecuteBatchJob"
          restartPolicy: Never


---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: {{ template "batch-server.fullname" . }}-ops-datetime-watcher
  namespace: {{ .Values.namespace }}
  labels:
    app: {{ template "batch-server.name" . }}
    chart: {{ template "batch-server.chart" . }}
    release: {{ template "batch-server.fullname" . }}
    heritage: {{ .Release.Service }}
spec:
  schedule: {{ .Values.cronjob.opsDatetimeWatcherSchedule }}
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: ops-datetime-watcher
              image: curlimages/curl:8.1.2
              imagePullPolicy: IfNotPresent
              command:
                - "curl"
              args:
                - "-X"
                - "POST"
                - "-d"
                - '{"job": "DatetimeWatcher"}'
                - "-H"
                - "authorization: bearer {{ template "service-token-secret" . }}"
                - "https://web-gateway.{{ .Values.namespace }}.svc.cluster.local:{{ .Values.cronjob.webGatewayPort }}/bucketeer.batch.BatchService/ExecuteBatchJob"
          restartPolicy: Never


---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: {{ template "batch-server.fullname" . }}-ops-event-count-watcher
  namespace: {{ .Values.namespace }}
  labels:
    app: {{ template "batch-server.name" . }}
    chart: {{ template "batch-server.chart" . }}
    release: {{ template "batch-server.fullname" . }}
    heritage: {{ .Release.Service }}
spec:
  schedule: {{ .Values.cronjob.opsEventCountWatcherSchedule }}}
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: ops-event-count-watcher
              image: curlimages/curl:8.1.2
              imagePullPolicy: IfNotPresent
              command:
                - "curl"
              args:
                - "-X"
                - "POST"
                - "-d"
                - '{"job": "EventCountWatcher"}'
                - "-H"
                - "authorization: bearer {{ template "service-token-secret" . }}"
                - "https://web-gateway.{{ .Values.namespace }}.svc.cluster.local:{{ .Values.cronjob.webGatewayPort }}/bucketeer.batch.BatchService/ExecuteBatchJob"
          restartPolicy: Never